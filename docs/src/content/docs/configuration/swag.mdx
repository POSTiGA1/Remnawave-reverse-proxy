---
title: Replacing default nginx with SWAG and configuring it for Remnawave
description: A guide on installing and configuring SWAG to replace the default nginx in Remnawave.
---

import { Steps, LinkButtons, Tabs, TabItem, Icons, FileTree, Code, Badges, LinkCard } from '@astrojs/starlight/components';

First, you need to decide whether you want to use [SWAG](https://github.com/linuxserver/docker-swag) or stick with the default nginx configuration. SWAG is a popular and easy choice for reverse proxy setups, especially when you've got a lot of stacks/containers to manage. It comes with built-it cert renewal, templates for various containers, which are a bit changed for beginner-friendly experience.

There are 2 ways. You are "geek" and you stick to [Pingora](https://github.com/cloudflare/pingora)/[River](https://github.com/memorysafety/river) or you are "normal" and you use default Nginx because you don't want to deal with it, aight? SWAG is same nginx you familiar with (watch the pic below), but with some extra features and easier configuration. 

:::tip[Contribution]
Your critisizm won't be even viewed. However, I appreciate any feedback for IMPROVING it!
:::

<div style={{ display: 'flex', justifyContent: 'center' }}>
  <img 
    src="https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/swag/dialog.webp" 
    alt="Netbird registration" 
    style={{ maxWidth: '60%' }} 
  />
</div>

:::danger[Important]
You can't use SWAG if you installed Panel and Node on one machine. Panel and node installation uses nginx.sock, but for some reason I didn't manage to make SWAG remove it, so you don't have to manually stop it. Otherwise it will give you a message that sock is already used.
:::

## Installing SWAG

:::note
All steps were reproduced under root.
:::

<Steps>

1. Create a directory for SWAG.

    ```bash
    mkdir /opt/swag
    ```

2. Create a docker compose file.

    ```bash
    nano docker-compose.yml
    ```

    ```yml
    swag:
      image: lscr.io/linuxserver/swag:latest
      container_name: swag
      cap_add:
        - NET_ADMIN
      environment:
        - PUID=1000
        - PGID=1000
        - TZ=Etc/UTC
        - URL=domain.com
        - VALIDATION=dns
        - SUBDOMAINS=wildcard
        - DNSPLUGIN=cloudflare
        - PROPAGATION=60
        - SWAG_AUTORELOAD=true
      volumes:
        - /path/to/swag:/config
      restart: unless-stopped
      networks:
        - remnawave-network

    networks:
      remnawave-network:
        name: remnawave-network
          driver: bridge
          external: true
    ```

      I guess optional, but can be added

    ```yml
      logging:
        driver: 'json-file'
        options:
          max-size: '30m'
          max-file: '5'
    ```

3. Generate a Cloudflare [API token](https://dash.cloudflare.com/profile/api-tokens) with `DNS:Read`, `DNS:Edit` permissions to `domain.com` and copy the token.

4. Edit `/path/to/swag/dns-conf/cloudflare.ini`, delete everything and paste the following with your token:

    ```ini
    dns_cloudflare_api_token = token
    ```

5. Delete nginx section in `/opt/remnawave/docker-compose.yml` and stop the stack.

    ```bash
    cd /opt/remnawave && docker compose down
    ```

6. Start the stack and monitor logs, we'll need them in a second.

    ```bash
    cd /opt/swag && docker compose up -d && docker compose logs -f -t
    ```

    In case you've done everything right "Server ready." will pop up in logs and make sure that `domain.com` shows the welcome page with a valid certificate. But we also need logs for monitoring autoreload logs in case you've done mistakes in proxy-conf.

</Steps>

## Configuring SWAG

Now we need to implement the nginx configuration we had for SWAG to work with remnawave panel & nodes.

<Steps>

1. Copy template for remnawave

    ```bash
    cd /path/to/swag/config/nginx/proxy-confs
    cp _template.subdomain.conf.sample remnawave.subdomain.conf
    ```

2. Edit the configuration file

    ```bash
    nano remnawave.subdomain.conf
    ```

3. If you want, you may delete everything in the file and paste the following:

    ```nginx
    map $http_cookie $auth_cookie {
    default 0;
    "~*abcdEfgH=IJKlmnoPq" 1;
    }

    map $arg_abcdEfgH $auth_query {
        default 0;
        "IJKlmnoPq" 1;
    }

    map "$auth_cookie$auth_query" $authorized {
        "~1" 1;
        default 0;
    }

    map $arg_abcdEfgH $set_cookie_header {
        "IJKlmnoPq" "abcdEfgH=IJKlmnoPq; Path=/; HttpOnly; Secure; SameSite=Strict; Max-Age=31536000";
        default "";
    }

    server {
        listen 443 ssl;

        server_name panel.*;

        include /config/nginx/ssl.conf;

        client_max_body_size 0;

        add_header Set-Cookie $set_cookie_header;

        location / {
            if ($authorized = 0) {
                return 444;
            }

            include /config/nginx/proxy.conf;
            include /config/nginx/resolver.conf;
            set $upstream_app remnawave;
            set $upstream_port 3000;
            set $upstream_proto http;
            proxy_pass $upstream_proto://$upstream_app:$upstream_port;

        }
    }

    server {
        listen 443 ssl;

        server_name subscription.*;

        include /config/nginx/ssl.conf;

        client_max_body_size 0;

        location / {
            include /config/nginx/proxy.conf;
            include /config/nginx/resolver.conf;
            set $upstream_app remnawave-subscription-page;
            set $upstream_port 3010;
            set $upstream_proto http;
            proxy_pass $upstream_proto://$upstream_app:$upstream_port;

        }

        location @redirect {
            return 404;
        }
    }
    ```

    You may get confused as a lot of strings are gone, that's because some parameters and headers are already present in SWAG's `proxy.conf` and `ssl.conf`, so you don't need to repeat them. If you want to add some headers, you add them back from `/opt/remnawave/nginx.conf`.

4. Navigate to `/path/to/swag/config/nginx/site-confs` and edit `default` file.

    ```nginx "ssl_reject_handshake on;"
    # main server block
    server {
        listen 443 ssl default_server;

        server_name _;
        ssl_reject_handshake on;
        include /config/nginx/ssl.conf;

</Steps>

## Adding mods

## Using Nginx.sock in SWAG