---
title: Руководство по установке и настройке Cert Warden
description: Инструкция по установке и настройке Cert Warden
---

import { Steps } from '@astrojs/starlight/components';
import { LinkButton } from '@astrojs/starlight/components';

**Cert Warden** — это централизованный клиент ACME (Automated Certificate Management Environment), предназначенный для упрощения управления SSL/TLS-сертификатами. Это open-source решение, которое предоставляет API для автоматизации получения, обновления и распространения сертификатов между различными системами и сервисами. Cert Warden разработан для упрощения работы с сертификатами в инфраструктурах, где требуется управление большим количеством сертификатов для разных доменов или устройств.

## Зачем нужен Cert Warden?
Cert Warden решает задачу автоматизации управления сертификатами в сложных инфраструктурах. Вот основные причины, зачем он может быть полезен:

1. **Автоматизация процессов:**
- Cert Warden автоматизирует получение, обновление и распространение SSL/TLS-сертификатов, что исключает необходимость ручного управления, которое может быть трудоемким и подверженным ошибкам.
- Поддерживает автоматическое продление сертификатов до истечения их срока действия, что минимизирует риски простоя из-за просроченных сертификатов.

2. **Централизованное управление:**
- Вместо того чтобы настраивать отдельные клиенты ACME на каждом сервере, Cert Warden позволяет управлять всеми сертификатами из одного места. Это особенно удобно в крупных инфраструктурах с множеством серверов или доменов.

3. **Безопасность:**
- Cert Warden использует API-ключи для аутентификации клиентов, обеспечивая безопасный доступ к сертификатам.
- Поддерживает работу с доверенными центрами сертификации, такими как Let’s Encrypt, что гарантирует использование валидных и признанных сертификатов.

## Установка и настройка Cert Warden

:::danger[Важно]
Устанавливать **Cert Warden** будем на сервер панели **Remnawave**, но вы можете установить его на любой другой сервер.
:::

:::danger[Важно]
Использовать метод будем **dns-01 Cloudflare**, но вы можете использовать и другие методы.
:::

<Steps>

1. Cоздаем директорию для Cert Warden и создаем `docker-compose.yml`

    ```bash
    mkdir /opt/certwarden && cd /opt/certwarden && nano docker-compose.yml
    ```

    Вставляем следующее содержимое:

    ```yaml title="docker-compose.yml"
    services:
      certwarden:
        container_name: certwarden
        image: ghcr.io/gregtwallace/certwarden:latest
        restart: unless-stopped
        ports:
          - '127.0.0.1:4050:4050'
        volumes:
          - ./certwarden-data:/app/data
        networks:
          - remnawave-network
        logging:
          driver: 'json-file'
          options:
            max-size: '30m'
            max-file: '5'

    volumes:
      certwarden-data:
        name: certwarden-data
        driver: local
        external: false
    networks:
      remnawave-network:
        name: remnawave-network
        driver: bridge
        external: false
    ```

2. Запускаем Cert Warden

    ```bash
    cd /opt/certwarden && docker compose up -d && docker compose logs -f
    ```

3. Добавляем Cert Warden в nginx.conf панели Remnawave

    ```bash
    cd /opt/remnawave && nano nginx.conf
    ```

    Добавляем секцию upstream:

    ```nginx title="nginx.conf"
    upstream certwarden {
        server 127.0.0.1:4050;
    }
    ```

    Добавляем секцию server:

    ```nginx title="nginx.conf"
    server {
        listen 443 ssl;
        server_name certwarden.example.com; # Не забываем добавить запись DNS в Cloudflare
        http2 on;

        ssl_certificate "/etc/nginx/ssl/example.com/fullchain.pem";
        ssl_certificate_key "/etc/nginx/ssl/example.com/privkey.pem";
        ssl_trusted_certificate "/etc/nginx/ssl/example.com/fullchain.pem";

        location / {
            proxy_pass http://certwarden;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
    ```

4. Перезапускаем nginx:

    ```bash
    cd /opt/remnawave && docker compose down remnawave-nginx && docker compose up -d remnawave-nginx
    ```

5. Открываем браузер и переходим по ссылке

    ```bash
    https://certwarden.example.com
    ```

6. Войдем в систему, используя admin и password

    ![Cert Warden login](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_login.png)

7. Попадаем на главную страницу

    ![Cert Warden dashboard](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_dashboard.png)

8. Переходим в раздел `Settings` и меняем наш текущий пароль

</Steps>

## Настройка Provider

<Steps>

1. Переходим в раздел `Providers`

2. Нажимаем на `New Provider`

3. Выбираем `DNS-01 Cloudflare`

4. В Domains вводим домен, на который будем получать wildcard сертификаты

5. API Access Method указываем `API Token`, как его получить можно посмотреть в [офф. документации](https://developers.cloudflare.com/fundamentals/api/get-started/create-token/)
      
      ![Cert Warden New Challenge Provider](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_new_challenge_provider.png)

6. Нажимаем на кнопку Submit

</Steps>

## Настройка Private Key

<Steps>

1. Переходим в раздел `Private Keys`

2. Нажимаем на `New Key`

3. В Name вводим название ключа (например, `ACME`)

4. Key Generation Algorithm указываем `ECDSA P-384`

5. Ставим галочку на Disable API Key

6. Нажимаем на кнопку Submit

7. Выскочит новое окно c нашим Private Key, так же нажимаем на кнопку Submit

      ![Cert Warden New Private Key](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_private_key.png)

</Steps>

## Настройка ACME Accounts

<Steps>

1. Переходим в раздел `ACME Accounts`

2. Нажимаем на `New Account`

3. В Name вводим название нашего домена или своё другое название

4. Contact E-mail Address указываем email, на который будут приходить уведомления

5. ACME Server выбираем `Lets Encrypt`

6. Private Key выбираем свой ранее созданный ключ

7. Ставим галочку на Accept ACME Server`s Terms of Service

8. Нажимаем на Submit

9. Выскочит новое окно c нашими данными Submit

      ![Cert Warden New ACME Account](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_acme_accounts.png)

10. Нажимаем на кнопку REGISTER и Account Status должен стать Valid

11. Нажимаем на кнопку Submit

</Steps>

## Настройка  Certificates

<Steps>

1. Переходим в раздел `Certificates`

2. Нажимаем на `New Certificate`

3. В Name вводим название нашего домена или своё другое название

4. ACME Account выбираем ранее созданный аккаунт

5. В Subject (and Common Name) вводим домен, на который будем получать wildcard сертификаты (например, `*.example.com`)

6. Нажимаем на кнопку Submit

    ![Cert Warden New Certificate](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_certificates.png)

7. Внизу появилось окно ACME Orders

      ![Cert Warden ACME Orders](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_acme_orders.png)

8. Нажимаем на кнопку Place new order

9. Теперь ожидаем, пока сертификат будет получен, отслеживать состояние можно в разделе ACME Queue, как только домен там пропадет, значит сертификат получен

10. Переходим в раздел Dashboard и видим, что сертификат получен и сколько дней осталось до окончания срока действия

      ![Cert Warden Dashboard](https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_dashboard_certificate.png) 

</Steps>

## Certwarden Client

**Cert Warden Client** — это Docker-контейнер или приложение, которое взаимодействует с сервером Cert Warden для автоматического получения и обновления сертификатов. Он предназначен для упрощения управления сертификатами на клиентских устройствах. Основные функции клиента включают:

- Автоматическое получение сертификатов: Клиент делает GET-запросы к API Cert Warden, используя API-ключи, для получения ключей и сертификатов.
- Обновление сертификатов: Клиент следит за обновлениями сертификатов и автоматически загружает новые версии.
- Перезапуск Docker-контейнеров: Если сертификаты обновлены, клиент может перезапустить указанные Docker-контейнеры, чтобы они подхватили новые сертификаты.


## Установка и настройка Certwarden Client

:::note
Устанавливать клиент будем так же на сервер панели Remnawave, чтобы мы могли тоже получать сертификаты.
:::

<Steps>

1. Создаем директорию для Cert Warden Client

    ```bash
    mkdir -p /opt/certwardenclient && cd /opt/certwardenclient && nano docker-compose.yml
    ```
   
   Вставляем следующее содержимое:

    ```yaml title="docker-compose.yml"
    services:
        certwardenclient:
          image: ghcr.io/gregtwallace/certwarden-client:latest
          container_name: certwardenclient
          restart: unless-stopped
          ports:
            - '127.0.0.1:5055:5055'
          volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /opt/certwardenclient/certs:/opt/certwarden/certs
          environment:
            TZ: "Europe/Moscow"
            CW_CLIENT_FILE_UPDATE_TIME_START: "02:00"
            CW_CLIENT_FILE_UPDATE_TIME_END: "03:00"
            CW_CLIENT_FILE_UPDATE_DAYS_OF_WEEK: "Mon Tue Wed Thu Fri Sat Sun"
            CW_CLIENT_RESTART_DOCKER_CONTAINER0: "remnawave-nginx"
            CW_CLIENT_AES_KEY_BASE64: "pLZEc_QvSka8syfQtuTfArblalMKU6C6Ke1uIji0E5g"
            CW_CLIENT_SERVER_ADDRESS: "https://certwarden.example.com"
            CW_CLIENT_KEY_NAME: "example.com"
            CW_CLIENT_KEY_APIKEY: "0UkmZEZK7oieQ6hmz9Fta2obMMZRjAuo"
            CW_CLIENT_CERT_NAME: "example.com"
            CW_CLIENT_CERT_APIKEY: "MkYMf7eXO8aB9xiNKqwvNVcDGKJ0Dg6v"
            CW_CLIENT_CERT_PATH: "/opt/certwarden/certs"
            CW_CLIENT_KEY_PEM_FILENAME: "privkey.pem"
            CW_CLIENT_CERTCHAIN_PEM_FILENAME: "fullchain.pem"
          networks:
            - remnawave-network
          logging:
            driver: 'json-file'
            options:
              max-size: '30m'
              max-file: '5'

    networks:
        remnawave-network:
          name: remnawave-network
          driver: bridge
          external: false
    ```

2. CW_CLIENT_AES_KEY_BASE64 - в разделе `Сertificates` нажимаем на наш сертификат, спускаемся ниже, находим вкладку `Post Processing`, видим поле Client AES Key и нажимаем кнопку GENERATE, это и будет наш `CW_CLIENT_AES_KEY_BASE64`

    <div style={{ display: 'flex', justifyContent: 'center' }}>
      <img 
        src="https://raw.githubusercontent.com/eGamesAPI/remnawave-reverse-proxy/refs/heads/main/docs/src/assets/en/certwarden/certwarden_aes_key.png" 
        alt="Cert Warden AES Key" 
        style={{ maxWidth: '50%' }} 
      />
    </div>

3. CW_CLIENT_SERVER_ADDRESS - адрес сервера Cert Warden (например, `https://certwarden.example.com`)

4. CW_CLIENT_KEY_NAME - название ключа, который мы создали в разделе `Private Keys`

4. CW_CLIENT_KEY_APIKEY - API ключ, который мы создали в разделе `Private Keys`

5. CW_CLIENT_CERT_NAME - название сертификата, который мы создали в разделе `Certificates`

6. CW_CLIENT_CERT_APIKEY - API ключ, который мы создали в разделе `Certificates`

7. Запускаем Cert Warden Client

    ```bash
    cd /opt/certwardenclient && docker compose up -d && docker compose logs -f
    ```
</Steps>